FROM node:24-trixie-slim AS build

ARG SENTRY_AUTH_TOKEN
ARG EXPO_PUBLIC_SENTRY_DSN
ARG EXPO_PUBLIC_API_URL
ARG EXPO_PUBLIC_DEVICE_FRONT_DOOR
ARG EXPO_PUBLIC_DEVICE_MAILBOX
ARG EXPO_PUBLIC_ENVIRONMENT

ENV SENTRY_AUTH_TOKEN=$SENTRY_AUTH_TOKEN
ENV EXPO_PUBLIC_SENTRY_DSN=$EXPO_PUBLIC_SENTRY_DSN
ENV EXPO_PUBLIC_API_URL=$EXPO_PUBLIC_API_URL
ENV EXPO_PUBLIC_DEVICE_FRONT_DOOR=$EXPO_PUBLIC_DEVICE_FRONT_DOOR
ENV EXPO_PUBLIC_DEVICE_MAILBOX=$EXPO_PUBLIC_DEVICE_MAILBOX
ENV EXPO_PUBLIC_ENVIRONMENT=$EXPO_PUBLIC_ENVIRONMENT

ENV PNPM_HOME="/pnpm"
ENV PATH="$PNPM_HOME:$PATH"

RUN corepack enable

WORKDIR /app
COPY . .

RUN pnpm i --force

EXPOSE 8081

CMD ["pnpm", "start"]
